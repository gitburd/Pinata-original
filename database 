CREATE DATABASE pinata;
\connect pinata;

CREATE TABLE users (user_id SERIAL PRIMARY KEY, first_name VARCHAR, last_name VARCHAR, email VARCHAR);
CREATE TABLE skills (skill_id SERIAL PRIMARY KEY, skill_title VARCHAR, skill_details VARCHAR, skill_icon VARCHAR);
CREATE TABLE emotions (emotion_id SERIAL PRIMARY KEY, emotion_text VARCHAR);
CREATE TABLE emotion_skills (emotion_skills_id SERIAL PRIMARY KEY, skill_id INT REFERENCES skills(skill_id), emotion_id INT REFERENCES emotions(emotion_id));
CREATE TABLE records (record_id SERIAL PRIMARY KEY, user_id INT REFERENCES users(user_id), skill_id INT REFERENCES skills(skill_id), emotion_id INT REFERENCES emotions(emotion_id), before_lvl INT, after_lvl INT, impact INT, date DATE );

INSERT INTO users (first_name, last_name, email) VALUES('firstname test','lastname test','test@email.com');
INSERT INTO skills (skill_title, skill_details, skill_icon) VALUES('Test skill', 'Lorium sermpra filler text is filling the text sapce.', 'url to the image');
INSERT INTO emotions (emotion_text) VALUES('test emotion');
INSERT INTO emotion_skills (skill_id, emotion_id) VALUES(1,2);
INSERT INTO records (user_id, skill_id, emotion_id, before_lvl, after_lvl, impact, date) VALUES (2,1,2,8,5,3,'2019-04-17');

SELECT * FROM users;
SELECT * FROM skills;
SELECT * FROM emotions; 
SELECT * FROM emotion_skills;
SELECT * FROM records;

INSERT INTO skills (skill_title, skill_details, skill_icon) VALUES('Play Video Games','Lorium sermpra filler text is filling the text sapce.', 'url to the image'),('Wring a Towel', 'Lorium sermpra filler text is filling the text sapce.', 'url to the image'),('Workout', 'Lorium sermpra filler text is filling the text sapce.', 'url to the image'),  ('Take a Breather', 'Lorium sermpra filler text is filling the text sapce.', 'url to the image'), ('Punch a Pillow','Lorium sermpra filler text is filling the text sapce.', 'url to the image');
INSERT INTO emotions (emotion_text) VALUES('Angry'),('Sad'),('Depressed'),('Isolated'),('Lonely'),('Scared'),('Hopeless');
INSERT INTO emotion_skills (emotion_id, skill_id) VALUES(3,6), (3,5), (3,4), (3,3);
INSERT INTO records (user_id, skill_id, emotion_id, before_lvl, after_lvl, impact, date) VALUES (2,2,3,8,5,3,'2019-04-15'), (2,5,3,7,2,5,'2019-04-16'), (2,6,3,8,9,-1,'2019-04-17');


SEARCH for Angry skills:
SELECT s.skill_title, s.skill_details, s.skill_icon FROM skills AS s JOIN emotion_skills AS es ON es.skill_id = s.skill_id JOIN emotions AS e ON es.emotion_id  =  e.emotion_id WHERE e.emotion_text = 'Angry';

SEARCH for User skills:
SELECT s.skill_title, s.skill_details, s.skill_icon FROM skills AS s JOIN records AS r ON r.skill_id  =  s.skill_id JOIN users AS u ON r.user_id  =  u.user_id WHERE u.user_id = 2 AND r.impact > 0; 

SEARCH for all of a Users Records :
SELECT s.skill_title, s.skill_icon, r.before_lvl, r.after_lvl, r.impact, r.date  FROM skills AS s JOIN records AS r ON r.skill_id  =  s.skill_id JOIN users AS u ON r.user_id  =  u.user_id WHERE u.user_id = 2; 


SEARCH for user Angry skills: 
SELECT s.skill_title, s.skill_details, s.skill_icon
FROM skills AS s
JOIN records AS r ON r.skill_id = s.skill_id
JOIN users AS u ON r.user_id = u.user_id
JOIN emotions AS e ON r.emotion_id = e.emotion_id
WHERE u.user_id = 2
AND r.impact > 0
AND e.emotion_text = 'Angry'; 

